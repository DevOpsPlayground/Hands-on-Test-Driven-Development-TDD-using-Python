### Prerequisites (Your own machine)
This playground uses the following technology so you will need to check they are installed:

-   VS Code
-   Python Extension for VSCode
-   Terminal (We use Bash)
-   Python
-   Flask
-   Pytest
-   Some knowledge of basic unit testing
-   Some knowledge of programming fundamenals

# Introduction
Test Driven Development is a software development methodology where tests are written before application code is written.
The idea is that a developer will think about how the user will use the application/components through the process of writing
tests that validate the operation.

In this playground we are going to build a web application in python and Flask via the TDD process.
We will write tests to describe the functionality of the components.

# set up your environment

### Opening the Next.js application in VS Code

### Step 1

Go back to https://lab.devopsplayground.org/.

If you need to, enter your name and surname again into the username box. 

You should be presented with the following page: 

<p align="center">
<img width="544" alt="Screenshot 2023-05-23 at 11 33 12" src="https://github.com/DevOpsPlayground/DPG-Meetups-Next.js/assets/101208108/a8e6b536-6926-4ae6-a72a-5c19e7f4d207">
</p>

### Step 2

Copy the IDE link

Open a new tab and paste that link into the address bar of the new tab. 

You should be presented with VS Code which should look something like this:


### Step 3
Make sure you have the python extension installed in .vscode which is automatically generated by the IDE.

We will be using the Testing toolbar in vscode. For this project you will need to manually change the .vscode that is auto generated by your IDE.
<p align="center">
<img width="668" alt="Screenshot 2023-05-23 at 10 06 27" src="https://github.com/cgungaloo/tdd_stock/blob/master/readme_resources/settings.png">
</p>

in the settings.json, replace the contents "python.testing.pytestArgs" with:

<p align="center">
<img width="668" alt="Screenshot 2023-05-23 at 10 06 27" src="https://github.com/cgungaloo/tdd_stock/blob/master/readme_resources/ide_view.png">
</p>


```
"python.testing.pytestArgs": [
        "project/tdd_stock/test"
    ],
```

### 4
In project/tdd_stock/test click on test_unit.py.
This should activate the test tool bar in the IDE on the left (you may need to restart the browser)
When you click on the test tool bar you should be able to see the test tree.

<p align="center">
<img width="668" alt="Screenshot 2023-05-23 at 10 06 27" src="https://github.com/cgungaloo/tdd_stock/blob/master/readme_resources/test_tree.png">
</p>


# Code base

App: the application directory where the flask application will be in

- app.py: the main flask application with the routes
- __init__.py : initialisation file for python.
- components.py: file containing helper functions for app.py
- models.py: contains the Stock class which defines the model for a stock

db: database file for our application

- stock_db.json: the database file containing stocks based off the Stock model.
This file will act as our database for our application

test: Directory for tests and tes resources

- __init__.py : initialisation file for python.
- test_data/stock_test.json: a test stock object that will be used in our tests
- notes.txt: notes contianing curl commands for manual testing
- test_int.py: integration tests will be written here
- test_unit.py: unit tests will be written here

# The Playground

### Step 1

We want to implement a feature where we can get all the stocks from the database as a list of stock objects.

Go to project/tdd_stock/test/test_unit.py. You will see test_get_all_stocks as the first test.

```

    def test_get_all_stocks_returns_all(self):
        stocks = get_all_stocks()

```

This test has not been fully implemented. So far it calls the get_all_stocks function but there are no assertions. Lets add a simple assertion to get us started.
We know that the database file has 3 stock objects. As a simple assertion we can check that when we get all stocks the list should be a length of 3.
Add this assertion to the test function

```

    def test_get_all_stocks_returns_all(self):
        stocks = get_all_stocks()
        
        assert len(stocks) == 3

```

If you run the test it will fail

<p align="center">
<img width="668" alt="Screenshot 2023-05-23 at 10 06 27" src="https://github.com/cgungaloo/tdd_stock/blob/master/readme_resources/get_all_stocks_initial_error.png">
</p>

Unsuprisingly, this is because the test function has no visibility of get_all_stocks. Since a stub function is already present in components.py, lets import it at the top of the test file. You can put it underneath the Stock model import

```

from app.models import Stock
from app.components import get_all_stocks

```
If you rerun the test you now get this error:

<p align="center">
<img width="668" alt="Screenshot 2023-05-23 at 10 06 27" src="https://github.com/cgungaloo/tdd_stock/blob/master/readme_resources/get_all_stocks_len_error.png">
</p>

We have now reached the "red" stage of the red, green, refactor TDD flow. We can fix this error by now implementing some application code to make the test pass.

### Step 2

Go to app/components.py and see the get_all_stocks_function

```
def get_all_stocks():

    with open('project/tdd_stock/db/stock_db.json') as dbfile:
        stocks_json = json.load(dbfile)
```

The function so far reads the db file and loads it into a json list using pythons json library.
Since the DB file is in the form of a json list, json.load will produce a list.
Lets return the list

```
def get_all_stocks():

    with open('project/tdd_stock/db/stock_db.json') as dbfile:
        stocks_json = json.load(dbfile)

    return stocks_json
```

The test will now pass, the "Green" stage in TDD.

<p align="center">
<img width="668" alt="Screenshot 2023-05-23 at 10 06 27" src="https://github.com/cgungaloo/tdd_stock/blob/master/readme_resources/get_all_stocks_test_pass_initial.png">
</p>



